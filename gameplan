x - Apply crd in make e2e-up
x - Rename to capi-dns-controller
x - rebase
x - rename test
x - Deploy contour in make e2e-up
x - Make a deployment manifest for capi-dns-controller
x   - rbac
x - Deploy capi-dns-controller in make e2e-up
  - Use metallb in our e2e tests
    - strict ARP mode?
  - Implement controller
  - create "make" task to run counterfeiter (or any go generate task)
    - consider reusing make generate for this
  - mgmt-cluster namespace tenancy:
    - CAPI-DNS controller only reads from Clusters in the same namespace as the
      GatewayDNS
    - CAPI-DNS controller only writes to Clusters in the same namespace as the
      GatewayDNS
  - rename cluster-a-gateway to not reference the cluster. It represents all of
    the clusters in a management namespace.


spec:
- clusterSelector: { ... }
- service: projectcontour/envoy
---
- watch gatewaydns (primary reconcile)
  - filter clusters that match clusterSelector
    - get secret for cluster
    - if resolutionType == loadBalancer
      - get loadbalancer ip using namespace and service in gatewaydnsrecord
      - else continue
    - for each cluster
      - write endpoint slice to cluster

- watch clusters

- watch clusters
  - if create/update cluster
    - start a watch for the cluster's service
  - if delete cluster
    - stop watch for the cluster's service

- watch service
  - maybe this can trigger the gatewaydnsrecord reconcile somehow?



Mon afternoon observations:
- When a cluster has no services *with external ips*, it should not create an
  enpoint slice for distribution to the workload clusters.  Right now the
  controller attempts to create an endpoint slice with a null address. The e2e
  test is failing because the controller is failing to write these bogus endpoint slices
  to workload clusters. I failed to write a failing controller test to expose this
  problem. The test at the bottom of
  pkg/controllers/gatewaydns/controller_test.go should be failing but is not.
  The controller has a lot of functionality, and probably should be broken up
  so it's easier to test.

